---
title: "Denoå­¦ä¹ è®°å½•"
date: 2025-04-15
tags:
  - Deno
cover: /img/deno.jpeg
---
# Denoå­¦ä¹ è®°å½• ğŸ“˜

<div align="left">

![Deno](https://img.shields.io/badge/Deno-v1.x-black?logo=deno)
<br>
![TypeScript](https://img.shields.io/badge/TypeScript-v5.x-blue?logo=typescript)
<br>
![MongoDB](https://img.shields.io/badge/MongoDB-v6.x-green?logo=mongodb)
<br>
![Oak](https://img.shields.io/badge/Oak-v12.x-lightgrey)

</div>

## ğŸ“‹ ç›®å½•

### ä¸€ã€DenoåŸºç¡€æŠ€æœ¯

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [DenoåŸºç¡€ç”¨æ³•](#denoåŸºç¡€ç”¨æ³•)
- [æƒé™ç®¡ç†](#æƒé™ç®¡ç†)
- [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
- [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
- [ç¬¬ä¸‰æ–¹åº“å’Œä¾èµ–ç®¡ç†](#ç¬¬ä¸‰æ–¹åº“å’Œä¾èµ–ç®¡ç†)
- [Denoéƒ¨ç½²æŒ‡å—](#denoéƒ¨ç½²æŒ‡å—)

### äºŒã€é¡¹ç›®å…·ä½“å®ç°

- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [APIè·¯ç”±](#apiè·¯ç”±)
- [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
- [MongoDBæ•°æ®åº“æ“ä½œ](#mongodbæ•°æ®åº“æ“ä½œ)
- [MBTIæµ‹è¯•å®ç°ç»†èŠ‚](#mbtiæµ‹è¯•å®ç°ç»†èŠ‚)

### ä¸‰ã€æœ€ä½³å®è·µå’Œæ‰©å±•

- [æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ](#æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ)
- [å‰ç«¯å±•ç¤ºä¸UIä¼˜åŒ–](#å‰ç«¯å±•ç¤ºä¸uiä¼˜åŒ–)
- [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [æ‰©å±•å’Œæ”¹è¿›](#æ‰©å±•å’Œæ”¹è¿›)
- [èµ„æºé“¾æ¥](#èµ„æºé“¾æ¥)

---

## ğŸš€ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºDenoè¿è¡Œæ—¶çš„åç«¯æœåŠ¡é¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬MBTIäººæ ¼æµ‹è¯•ç³»ç»Ÿã€‚é¡¹ç›®é‡‡ç”¨TypeScriptè¯­è¨€å¼€å‘ï¼Œä½¿ç”¨Oak HTTPæœåŠ¡å™¨æ¡†æ¶å¤„ç†HTTPè¯·æ±‚ï¼ŒMongoDBä½œä¸ºæ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ’» æŠ€æœ¯æ ˆ

| åˆ†ç±» | æŠ€æœ¯ | æè¿° |
|------|------|------|
| **è¿è¡Œæ—¶ç¯å¢ƒ** | Deno | å®‰å…¨çš„JavaScriptå’ŒTypeScriptè¿è¡Œæ—¶ |
| **è¯­è¨€** | TypeScript | å¸¦æœ‰ç±»å‹ç³»ç»Ÿçš„JavaScriptè¶…é›† |
| **HTTPæœåŠ¡å™¨æ¡†æ¶** | Oak | å—Koaå¯å‘çš„Denoä¸­é—´ä»¶æ¡†æ¶ |
| **æ•°æ®åº“** | MongoDB | NoSQLæ–‡æ¡£æ•°æ®åº“ |
| **ODM** | Mongoose | MongoDBå¯¹è±¡æ¨¡å‹å·¥å…· |
| **APIæ–‡æ¡£** | æš‚æ—  | å¯è€ƒè™‘æ·»åŠ Swagger |
| **æµ‹è¯•æ¡†æ¶** | Denoå†…ç½®æµ‹è¯•å·¥å…· | Denoè‡ªå¸¦çš„æµ‹è¯•åŠŸèƒ½ |

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹é¡¹ç›®ä¹‹å‰ï¼Œè¯·å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒï¼š

### 1. å®‰è£…Deno

Deno æ˜¯ä¸€ä¸ªç°ä»£çš„JavaScriptå’ŒTypeScriptè¿è¡Œæ—¶ç¯å¢ƒã€‚æ¨èä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š

| æ“ä½œç³»ç»Ÿ | å‘½ä»¤ |
| --- | --- |
| macOS / Linux | \`curl -fsSL <https://deno.land/install.sh> |
| Windows | \`irm <https://deno.land/install.ps1> |

éªŒè¯å®‰è£…ï¼š

```bash
deno --version
```

> **æ³¨**ï¼šæ›´å¤šå®‰è£…é€‰é¡¹ï¼ˆå¦‚Homebrewï¼‰è¯·å‚è€ƒ Denoå®‰è£…æŒ‡å—ã€‚

### 2. å®‰è£…MongoDB

é¡¹ç›®ä½¿ç”¨ MongoDB ä½œä¸ºæ•°æ®åº“ã€‚æ‚¨å¯ä»¥é€‰æ‹©æœ¬åœ°å®‰è£…æˆ–ä½¿ç”¨Dockerã€‚

#### 2.1 æœ¬åœ°å®‰è£…MongoDB

è¯·è®¿é—® MongoDBå®‰è£…æŒ‡å— å®‰è£…ã€‚å¯åŠ¨æœåŠ¡ï¼š

```bash
mongod
```

#### 2.2 ä½¿ç”¨Dockerè¿è¡ŒMongoDB

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
docker run -d -p 27017:27017 --name mongodb mongo:latest
```

## ğŸ¦• DenoåŸºç¡€ç”¨æ³•

## âš¡ å¸¸ç”¨å‘½ä»¤

é¡¹ç›®ä¸­å®šä¹‰äº†å¤šä¸ªDenoä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡`deno task <task_name>`æ‰§è¡Œï¼š

| å‘½ä»¤ | æè¿° |
|------|------|
| `deno task dev` | å¼€å‘æ¨¡å¼å¯åŠ¨ |
| `deno task start` | ç”Ÿäº§æ¨¡å¼å¯åŠ¨ |
| `deno task hot-reload` | çƒ­é‡è½½æ¨¡å¼ |
| `deno task test` | è¿è¡Œæµ‹è¯• |
| `deno task mongo:init` | åˆå§‹åŒ–MongoDB |
| `deno task mongo:generate-mbti` | ç”ŸæˆMBTIæµ‹è¯•æ•°æ® |
| `deno run task -- watch` | ç›‘å¬æ–‡ä»¶å˜åŒ– |

### æ–‡ä»¶æ“ä½œ

#### è¯»å–æ–‡ä»¶

Denoæä¾›äº†ç®€å•ç›´è§‚çš„æ–‡ä»¶APIï¼š

```typescript
// åŒæ­¥è¯»å–æ–‡ä»¶
const text = Deno.readTextFileSync("./data/config.json");
const data = JSON.parse(text);

// å¼‚æ­¥è¯»å–æ–‡ä»¶
try {
  const text = await Deno.readTextFile("./data/users.json");
  const users = JSON.parse(text);
  console.log(users);
} catch (error) {
  console.error("è¯»å–æ–‡ä»¶å¤±è´¥:", error);
}

// è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶
const data = await Deno.readFile("./assets/image.png");
```

#### å†™å…¥æ–‡ä»¶

```typescript
// åŒæ­¥å†™å…¥æ–‡æœ¬æ–‡ä»¶
const data = { name: "Test User", email: "test@example.com" };
Deno.writeTextFileSync("./data/user.json", JSON.stringify(data, null, 2));

// å¼‚æ­¥å†™å…¥æ–‡ä»¶
await Deno.writeTextFile("./logs/app.log", `[${new Date().toISOString()}] Server started\n`, { append: true });

// å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶
await Deno.writeFile("./output/data.bin", new Uint8Array([0, 1, 2, 3, 4]));
```

#### æ–‡ä»¶æ“ä½œå·¥å…·å‡½æ•°

```typescript
// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
async function fileExists(path: string): Promise<boolean> {
  try {
    await Deno.stat(path);
    return true;
  } catch (error) {
    if (error instanceof Deno.errors.NotFound) {
      return false;
    }
    throw error;
  }
}

// åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
async function ensureDir(dir: string): Promise<void> {
  try {
    const fileInfo = await Deno.stat(dir);
    if (!fileInfo.isDirectory) {
      throw new Error(`è·¯å¾„å­˜åœ¨ä½†ä¸æ˜¯ç›®å½•: ${dir}`);
    }
  } catch (error) {
    if (error instanceof Deno.errors.NotFound) {
      await Deno.mkdir(dir, { recursive: true });
      return;
    }
    throw error;
  }
}
```

### å¤„ç†é™æ€èµ„æº

åœ¨Oak HTTPæœåŠ¡å™¨æ¡†æ¶ä¸­ä½¿ç”¨é™æ€æ–‡ä»¶ä¸­é—´ä»¶ï¼š

```typescript
import { Application, Router } from "oak";
import { send } from "https://deno.land/x/oak@v12.6.1/send.ts";

const app = new Application();
const router = new Router();

// é™æ€æ–‡ä»¶å¤„ç†ä¸­é—´ä»¶
app.use(async (ctx, next) => {
  try {
    // å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚
    if (ctx.request.url.pathname.startsWith("/static")) {
      const path = ctx.request.url.pathname.replace("/static", "");
      await send(ctx, path, {
        root: `${Deno.cwd()}/public`,
        index: "index.html",
      });
      return;
    }
    await next();
  } catch (err) {
    if (err.status !== 404) {
      throw err;
    }
    await next();
  }
});

// è‡ªå®šä¹‰é™æ€æ–‡ä»¶æœåŠ¡å‡½æ•°
async function serveStaticFile(ctx: Context, filePath: string): Promise<void> {
  try {
    const fullPath = `${Deno.cwd()}/public/${filePath}`;
    
    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    try {
      await Deno.stat(fullPath);
    } catch (error) {
      if (error instanceof Deno.errors.NotFound) {
        ctx.response.status = 404;
        ctx.response.body = { error: "File not found" };
        return;
      }
      throw error;
    }
    
    // è®¾ç½®å†…å®¹ç±»å‹
    let contentType = "application/octet-stream";
    if (filePath.endsWith(".html")) contentType = "text/html";
    else if (filePath.endsWith(".css")) contentType = "text/css";
    else if (filePath.endsWith(".js")) contentType = "text/javascript";
    else if (filePath.endsWith(".json")) contentType = "application/json";
    else if (filePath.endsWith(".png")) contentType = "image/png";
    else if (filePath.endsWith(".jpg") || filePath.endsWith(".jpeg")) contentType = "image/jpeg";
    
    // è¯»å–å¹¶å‘é€æ–‡ä»¶
    const content = await Deno.readFile(fullPath);
    ctx.response.headers.set("Content-Type", contentType);
    ctx.response.body = content;
  } catch (error) {
    console.error(`æä¾›é™æ€æ–‡ä»¶å¤±è´¥: ${filePath}`, error);
    ctx.response.status = 500;
    ctx.response.body = { error: "Internal server error" };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
router.get("/images/:filename", async (ctx) => {
  const filename = ctx.params.filename;
  await serveStaticFile(ctx, `images/${filename}`);
});
```

### ä½¿ç”¨Webæ ‡å‡†API

Denoä½¿ç”¨Webæ ‡å‡†APIè¿›è¡Œå¼€å‘ï¼Œæ— éœ€é¢å¤–çš„åº“ï¼š

```typescript
// ä½¿ç”¨fetch APIå‘èµ·ç½‘ç»œè¯·æ±‚
async function fetchData(url: string) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTPé”™è¯¯: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error("è¯·æ±‚å¤±è´¥:", error);
    return null;
  }
}

// ä½¿ç”¨URL APIè§£æURL
const url = new URL("https://example.com/api/users?page=1&limit=10");
console.log(url.searchParams.get("page")); // "1"

// ä½¿ç”¨EventTarget
const target = new EventTarget();
target.addEventListener("message", (event) => {
  console.log("æ”¶åˆ°æ¶ˆæ¯:", event.detail);
});
target.dispatchEvent(new CustomEvent("message", { detail: "Hello Deno!" }));
```

### ä½¿ç”¨Web Worker

Denoæ”¯æŒå¤šçº¿ç¨‹å¤„ç†ï¼š

```typescript
// main.ts
// åˆ›å»ºWeb Worker
const worker = new Worker(new URL("./worker.ts", import.meta.url).href, { type: "module" });

// å‘é€æ¶ˆæ¯åˆ°Worker
worker.postMessage({ type: "process", data: [1, 2, 3, 4, 5] });

// å¤„ç†Workerè¿”å›çš„æ¶ˆæ¯
worker.onmessage = (e) => {
  console.log("Workerç»“æœ:", e.data);
  // å®Œæˆåç»ˆæ­¢Worker
  worker.terminate();
};

// worker.ts
// æ¥æ”¶å¹¶å¤„ç†ä¸»çº¿ç¨‹æ¶ˆæ¯
self.onmessage = async (e) => {
  const { type, data } = e.data;
  
  if (type === "process") {
    // æ‰§è¡Œè€—æ—¶æ“ä½œ
    const result = await processData(data);
    // è¿”å›ç»“æœç»™ä¸»çº¿ç¨‹
    self.postMessage(result);
  }
};

async function processData(numbers: number[]): Promise<number> {
  // æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—
  await new Promise(resolve => setTimeout(resolve, 1000));
  return numbers.reduce((sum, num) => sum + num, 0);
}
```

### æ‰§è¡ŒShellå‘½ä»¤

Denoæä¾›APIæ‰§è¡Œå­è¿›ç¨‹ï¼š

```typescript
// ç®€å•å‘½ä»¤æ‰§è¡Œ
const process = Deno.run({
  cmd: ["ls", "-la"],
  stdout: "piped",
  stderr: "piped"
});

// ç­‰å¾…å‘½ä»¤å®Œæˆå¹¶è·å–è¾“å‡º
const { code } = await process.status();
if (code === 0) {
  const output = await process.output();
  console.log(new TextDecoder().decode(output));
} else {
  const errorOutput = await process.stderrOutput();
  console.error(new TextDecoder().decode(errorOutput));
}
process.close();

// ä¼ é€’ç¯å¢ƒå˜é‡
const process = Deno.run({
  cmd: ["printenv", "MY_VARIABLE"],
  env: { "MY_VARIABLE": "Hello Deno!" },
  stdout: "piped"
});
```

### ä½¿ç”¨WebSocket

Denoæ”¯æŒWebSocketè¿›è¡Œå®æ—¶é€šä¿¡ï¼š

```typescript
// æœåŠ¡ç«¯WebSocket
import { Application } from "oak";
import { Server } from "https://deno.land/std@0.196.0/http/server.ts";
import { WebSocketServer } from "https://deno.land/x/websocket@v0.1.4/mod.ts";

// åˆ›å»ºWebSocketæœåŠ¡å™¨
const wss = new WebSocketServer({ port: 8080 });

wss.on("connection", (ws) => {
  console.log("æ–°å®¢æˆ·ç«¯è¿æ¥");
  
  // å¤„ç†æ¶ˆæ¯
  ws.on("message", (message) => {
    console.log("æ”¶åˆ°æ¶ˆæ¯:", message);
    // å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯
    wss.clients.forEach((client) => {
      if (client.readyState === WebSocket.OPEN) {
        client.send(`æœåŠ¡å™¨æ—¶é—´: ${new Date().toISOString()}, æ¶ˆæ¯: ${message}`);
      }
    });
  });
  
  // å¤„ç†è¿æ¥å…³é—­
  ws.on("close", () => {
    console.log("å®¢æˆ·ç«¯æ–­å¼€è¿æ¥");
  });
});

// å®¢æˆ·ç«¯WebSocket
const socket = new WebSocket("ws://localhost:8080");

socket.onopen = () => {
  console.log("è¿æ¥å·²å»ºç«‹");
  socket.send("Hello Server!");
};

socket.onmessage = (event) => {
  console.log("æ”¶åˆ°æ¶ˆæ¯:", event.data);
};

socket.onclose = () => {
  console.log("è¿æ¥å·²å…³é—­");
};
```

---

## ğŸ” ç¯å¢ƒå˜é‡

é¡¹ç›®é€šè¿‡`.env`æ–‡ä»¶å’Œ`Deno.env.get()`æ–¹æ³•ç®¡ç†ç¯å¢ƒå˜é‡ï¼š

```
MONGODB_URI=mongodb://[username]:[password]@[host]/
MONGODB_DATABASE=database_name
```

> âš ï¸ **è­¦å‘Š**: åˆ‡å‹¿å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„.envæ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚

---

## ğŸ›¡ï¸ æƒé™ç®¡ç†

Denoéœ€è¦æ˜ç¡®çš„æƒé™æ‰èƒ½è®¿é—®ç³»ç»Ÿèµ„æºï¼š

| æƒé™æ ‡å¿— | æè¿° |
|----------|------|
| `--allow-net` | ç½‘ç»œè®¿é—®æƒé™ |
| `--allow-env` | ç¯å¢ƒå˜é‡è®¿é—®æƒé™ |
| `--allow-read` | æ–‡ä»¶è¯»å–æƒé™ |
| `--allow-write` | æ–‡ä»¶å†™å…¥æƒé™ |
| `--allow-sys` | ç³»ç»Ÿä¿¡æ¯è®¿é—®æƒé™ |

åœ¨`deno.json`ä¸­ï¼Œè¿™äº›æƒé™å·²é€šè¿‡taské…ç½®è¿›è¡Œé¢„è®¾ã€‚

---

## ğŸ“¦ ç¬¬ä¸‰æ–¹åº“å’Œä¾èµ–ç®¡ç†

### å¸¸ç”¨ç¬¬ä¸‰æ–¹åº“

| åº“å | æ¥æº | ä½œç”¨ | ç”¨æ³•ç¤ºä¾‹ |
|------|------|------|---------|
| **Oak** | JSR | HTTPæœåŠ¡å™¨æ¡†æ¶ | `import { Application } from "oak";` |
| **Mongoose** | npm | MongoDBå¯¹è±¡å»ºæ¨¡å·¥å…· | `import mongoose from "mongoose";` |
| **Zod** | npm | ç±»å‹éªŒè¯åº“ | `import { z } from "zod";` |
| **std/assert** | JSR | æ–­è¨€åº“ | `import { assertEquals } from "@std/assert";` |
| **cliffy** | deno.land | CLIæ¡†æ¶å’Œå·¥å…· | `import { Command } from "cliffy";` |
| **Fresh** | JSR | Webæ¡†æ¶ | `import { defineConfig } from "fresh";` |
| **MD5** | npm | å“ˆå¸ŒåŠ å¯†ç®—æ³• | `import md5 from "md5";` |
| **AJV** | esm.sh | JSON SchemaéªŒè¯å™¨ | `import Ajv from "ajv";` |
| **JWT** | deno.land | JSON Web Tokenå¤„ç† | `import { create, verify } from "djwt";` |

### æ•°æ®éªŒè¯ä¸å®‰å…¨ç›¸å…³åº“

#### 1. AJV å’Œ JSON Schema

[AJV](https://ajv.js.org/)æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„JSON SchemaéªŒè¯å™¨ï¼Œç”¨äºéªŒè¯æ•°æ®ç»“æ„æ˜¯å¦ç¬¦åˆé¢„å®šä¹‰çš„æ¨¡å¼ï¼š

```typescript
import Ajv from "ajv";
import addFormats from "ajv-formats";

// åˆå§‹åŒ–AJV
const ajv = new Ajv({
  allErrors: true,      // æŠ¥å‘Šæ‰€æœ‰é”™è¯¯ï¼ˆè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªï¼‰
  removeAdditional: true, // åˆ é™¤schemaä¸­æœªå®šä¹‰çš„å±æ€§
  useDefaults: true     // ä½¿ç”¨æ¨¡å¼ä¸­å®šä¹‰çš„é»˜è®¤å€¼
});

// æ·»åŠ æ ¼å¼éªŒè¯
addFormats(ajv);

// å®šä¹‰JSON Schema
const userSchema = {
  type: "object",
  properties: {
    id: { type: "string" },
    name: { type: "string", minLength: 2 },
    email: { type: "string", format: "email" },
    age: { type: "number", minimum: 0 }
  },
  required: ["id", "name", "email"],
  additionalProperties: false
};

// ç¼–è¯‘schemaä»¥ä¾¿é‡å¤ä½¿ç”¨
const validateUser = ajv.compile(userSchema);

// ä½¿ç”¨å°è£…çš„éªŒè¯å·¥å…·
function validateData(data: unknown, schema: object): { isValid: boolean; errors: any[] } {
  const validate = ajv.compile(schema);
  const isValid = validate(data);
  return {
    isValid,
    errors: isValid ? [] : (validate.errors || [])
  };
}

// ç¤ºä¾‹ä½¿ç”¨
const result = validateData(userData, userSchema);
if (!result.isValid) {
  console.error("æ•°æ®éªŒè¯å¤±è´¥:", result.errors);
}
```

**æœ€ä½³å®è·µï¼š**

- é›†ä¸­ç®¡ç†æ‰€æœ‰JSON Schemaå®šä¹‰
- ä¸ºå¤æ‚APIåˆ›å»ºå¯é‡ç”¨çš„éªŒè¯å‡½æ•°
- ä½¿ç”¨AJVçš„è‡ªå®šä¹‰å…³é”®å­—å’Œæ ¼å¼æ‹“å±•ç‰¹å®šéœ€æ±‚
- åœ¨APIç«¯ç‚¹å¤„ç†å‰éªŒè¯è¯·æ±‚æ•°æ®

#### 2. MD5

MD5æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œåœ¨é¡¹ç›®ä¸­å¸¸ç”¨äºå¯†ç åŠ å¯†æˆ–ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼š

```typescript
import md5 from "md5";

// åŸºæœ¬ä½¿ç”¨
const hash = md5("some-string"); // è¿”å›32å­—ç¬¦çš„å“ˆå¸Œå­—ç¬¦ä¸²

// ç”¨äºå¯†ç åŠ å¯†ï¼ˆæ¨èæ·»åŠ ç›å€¼ï¼‰
function hashPassword(password: string, salt: string): string {
  return md5(password + salt);
}

// ç”¨äºç”ŸæˆAPIè¯·æ±‚ç­¾å
function generateSignature(params: Record<string, string>, secretKey: string): string {
  // æŒ‰å­—æ¯é¡ºåºæ’åºå‚æ•°
  const sortedKeys = Object.keys(params).sort();
  let signStr = "";
  
  // æ„å»ºç­¾åå­—ç¬¦ä¸²
  for (const key of sortedKeys) {
    signStr += `${key}=${params[key]}&`;
  }
  
  // æ·»åŠ å¯†é’¥å¹¶ç”Ÿæˆæœ€ç»ˆç­¾å
  signStr += secretKey;
  return md5(signStr);
}
```

**å®‰å…¨æç¤ºï¼š**

- âš ï¸ MD5ä¸å†è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„å¯†ç å“ˆå¸Œç®—æ³•
- å¯¹äºå¯†ç å­˜å‚¨ï¼Œæ¨èä½¿ç”¨æ›´å®‰å…¨çš„ç®—æ³•å¦‚bcryptæˆ–Argon2
- MD5é€‚ç”¨äºéå®‰å…¨åœºæ™¯å¦‚ç¼“å­˜é”®ç”Ÿæˆã€å†…å®¹å®Œæ•´æ€§æ ¡éªŒç­‰

#### 3. JWT (JSON Web Token)

JWTç”¨äºåˆ›å»ºå’ŒéªŒè¯ä»¤ç‰Œï¼Œå¸¸ç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒï¼š

```typescript
import { create, verify, decode } from "djwt";
import { crypto } from "std/crypto";

// ç”Ÿæˆå¯†é’¥
async function generateKey(): Promise<CryptoKey> {
  return await crypto.subtle.generateKey(
    { name: "HMAC", hash: "SHA-512" },
    true,
    ["sign", "verify"]
  );
}

// åˆ›å»ºJWTä»¤ç‰Œ
async function createToken(
  payload: Record<string, unknown>, 
  expiresIn: number = 60 * 60 // 1å°æ—¶ï¼Œä»¥ç§’ä¸ºå•ä½
): Promise<string> {
  const key = await generateKey();
  
  const jwt = await create(
    { alg: "HS512", typ: "JWT" },
    { 
      ...payload, 
      exp: Math.floor(Date.now() / 1000) + expiresIn 
    },
    key
  );
  
  return jwt;
}

// éªŒè¯JWTä»¤ç‰Œ
async function verifyToken(token: string): Promise<Record<string, unknown> | null> {
  try {
    const key = await generateKey(); // ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥é‡ç”¨å¯†é’¥
    const payload = await verify(token, key);
    return payload;
  } catch (err) {
    console.error("JWTéªŒè¯å¤±è´¥:", err);
    return null;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const userToken = await createToken({ userId: "123", role: "admin" });
// åœ¨è¯·æ±‚å¤´ä¸­ä½¿ç”¨: Authorization: Bearer <token>

// èº«ä»½éªŒè¯ä¸­é—´ä»¶
async function authMiddleware(ctx: Context, next: Next) {
  try {
    const authHeader = ctx.request.headers.get("Authorization");
    
    if (!authHeader || !authHeader.startsWith("Bearer ")) {
      throw new Error("ç¼ºå°‘æœ‰æ•ˆçš„æˆæƒä»¤ç‰Œ");
    }
    
    const token = authHeader.replace("Bearer ", "");
    const payload = await verifyToken(token);
    
    if (!payload) {
      throw new Error("æ— æ•ˆçš„ä»¤ç‰Œ");
    }
    
    // å°†ç”¨æˆ·ä¿¡æ¯é™„åŠ åˆ°ä¸Šä¸‹æ–‡
    ctx.state.user = payload;
    await next();
  } catch (error) {
    ctx.response.status = 401;
    ctx.response.body = {
      success: false,
      code: 401,
      message: "æœªæˆæƒè®¿é—®"
    };
  }
}
```

**JWTæœ€ä½³å®è·µï¼š**

- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…ä»¤ç‰Œæ°¸ä¹…æœ‰æ•ˆ
- ä»…åœ¨ä»¤ç‰Œä¸­å­˜å‚¨å¿…è¦ä¿¡æ¯ï¼Œé¿å…å­˜å‚¨æ•æ„Ÿæ•°æ®
- ä½¿ç”¨HTTPSä¼ è¾“ä»¤ç‰Œ
- å®ç°ä»¤ç‰Œåˆ·æ–°æœºåˆ¶
- è€ƒè™‘ä½¿ç”¨Redisç­‰å­˜å‚¨æœºåˆ¶æ¥æ”¯æŒä»¤ç‰ŒåŠé”€

### å®é™…åº”ç”¨ç¤ºä¾‹

#### JSON Schemaç”¨äºAPIéªŒè¯

```typescript
// src/schemas/user.schema.ts
export const createUserSchema = {
  type: "object",
  properties: {
    username: { type: "string", minLength: 3, maxLength: 20 },
    email: { type: "string", format: "email" },
    password: { type: "string", minLength: 8 }
  },
  required: ["username", "email", "password"],
  additionalProperties: false
};

// src/middlewares/validate.middleware.ts
import { Context, Next } from "oak";
import { validateSchema } from "../utils/json-schema.ts";

export function validateRequest(schema: object) {
  return async (ctx: Context, next: Next) => {
    try {
      const body = await ctx.request.body().value;
      const { isValid, errors } = validateSchema(body, schema);
      
      if (!isValid) {
        ctx.response.status = 400;
        ctx.response.body = {
          success: false,
          code: 400,
          message: "è¯·æ±‚æ•°æ®éªŒè¯å¤±è´¥",
          errors: errors
        };
        return;
      }
      
      await next();
    } catch (error) {
      ctx.response.status = 400;
      ctx.response.body = {
        success: false,
        code: 400,
        message: "æ— æ•ˆçš„è¯·æ±‚æ•°æ®"
      };
    }
  };
}

// è·¯ç”±ä¸­ä½¿ç”¨éªŒè¯ä¸­é—´ä»¶
router.post("/api/users", validateRequest(createUserSchema), userController.createUser);
```

#### MD5ç”¨äºç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦

```typescript
// ç”Ÿæˆæµ‹è¯•ID
function generateTestId(userId: string, timestamp: number): string {
  return md5(`${userId}-${timestamp}-${Math.random()}`).substring(0, 16);
}

// MBTIæµ‹è¯•æäº¤
async function submitTest(testData: MBTITestSubmission) {
  const now = new Date();
  const testId = generateTestId(testData.user_id, now.getTime());
  
  // å­˜å‚¨æµ‹è¯•æ•°æ®...
}
```

### JSR (DenoåŒ…æ³¨å†Œè¡¨)

JSRæ˜¯å®˜æ–¹çš„DenoåŒ…æ³¨å†Œè¡¨ï¼Œæä¾›TypeScriptå’ŒJavaScriptåŒ…ï¼š

```typescript
// ä»JSRå¯¼å…¥åŒ…
import { Application, Router } from "jsr:@oak/oak@^12.6.1";
import { assertEquals } from "jsr:@std/assert@1";
```

#### åœ¨é¡¹ç›®ä¸­ä½¿ç”¨JSR

1. åœ¨`deno.json`ä¸­é…ç½®importsï¼š

```json
{
  "imports": {
    "@std/assert": "jsr:@std/assert@1",
    "oak": "jsr:@oak/oak@^12.6.1",
    "fresh": "jsr:@denoland/fresh@^2.0.0"
  }
}
```

2. ç„¶ååœ¨ä»£ç ä¸­å¯¼å…¥ï¼š

```typescript
import { Application } from "oak";
import { assertEquals } from "@std/assert";
```

### NPMæ”¯æŒ

Denoæ”¯æŒç›´æ¥ä½¿ç”¨NPMåŒ…ï¼Œæ— éœ€è½¬æ¢æˆ–é¢å¤–å·¥å…·ï¼š

```typescript
// ç›´æ¥ä»npmå¯¼å…¥
import mongoose from "npm:mongoose@^8.0.0";
import { z } from "npm:zod@^3.22.4";
```

#### åœ¨é¡¹ç›®ä¸­ä½¿ç”¨NPMåŒ…

1. åœ¨`deno.json`ä¸­é…ç½®importsï¼š

```json
{
  "imports": {
    "mongoose": "npm:mongoose@^8.0.0",
    "zod": "npm:zod@^3.22.4",
    "md5": "npm:md5@^2.3.0"
  }
}
```

2. ç„¶ååœ¨ä»£ç ä¸­å¯¼å…¥ï¼š

```typescript
import mongoose from "mongoose";
import { z } from "zod";
```

### å…¶ä»–æºå¯¼å…¥

Denoè¿˜æ”¯æŒä»URLç›´æ¥å¯¼å…¥ï¼š

```typescript
// ä»URLå¯¼å…¥
import { Command } from "https://deno.land/x/cliffy@v0.25.7/command/mod.ts";
import { MySQLConnector } from "https://deno.land/x/mysql@v2.12.1/mod.ts";
```

### åŒ…ç‰ˆæœ¬ç®¡ç†

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
/
â”œâ”€â”€ main.ts                # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶
â”‚   â””â”€â”€ examples/          # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ deno.json              # Denoé¡¹ç›®é…ç½®
â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡
```

---

## ğŸ”Œ APIè·¯ç”±

é¡¹ç›®ä½¿ç”¨Oak HTTPæœåŠ¡å™¨æ¡†æ¶å®šä¹‰è·¯ç”±ï¼Œä¸»è¦APIè·¯ç”±åŒ…æ‹¬ï¼š

### MBTIæµ‹è¯•API

```typescript
// MBTIæµ‹è¯•ç›¸å…³è·¯ç”±
router.get("/api/mbti/questions", mbtiController.getQuestions);
router.get("/api/mbti/types", mbtiController.getAllTypes);
router.get("/api/mbti/types/:type", mbtiController.getTypeDetails);
router.get("/api/mbti/roles", mbtiController.getRoles);
router.post("/api/mbti/test", mbtiController.submitTest);
router.get("/api/mbti/user/:userId/history", authMiddleware, mbtiController.getUserTestHistory);
```

> ğŸ“ **æ³¨æ„**ï¼šç”¨æˆ·å†å²è®°å½•APIéœ€è¦èº«ä»½éªŒè¯ã€‚

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### MBTIç›¸å…³æ¨¡å‹

<details>
<summary><b>MBTIQuestion</b>: MBTIæµ‹è¯•é—®é¢˜</summary>

```typescript
interface MBTIQuestion {
  id: number;
  question: string;
  options: Array<{
    value: string;
    text: string;
  }>;
  dimension: string;
}
```
</details>

<details>
<summary><b>MBTIType</b>: MBTIäººæ ¼ç±»å‹</summary>

```typescript
interface MBTIType {
  type: string;       // å¦‚ "INTJ-A"
  name: string;       // å¦‚ "å»ºç­‘å¸ˆ"
  title: string;      // å¦‚ "å»ºç­‘å¸ˆ (è‡ªä¿¡å‹)"
  description: string;
  strengths: string[];
  weaknesses: string[];
  roles: string;
  careers: string[];
  famousPeople: string[];
}
```
</details>

<details>
<summary><b>MBTIRole</b>: MBTIè§’è‰²åˆ†ç±»</summary>

```typescript
interface MBTIRole {
  role: string;      // å¦‚ "åˆ†æå¸ˆ"
  types: string[];   // å¦‚ ["INTJ", "INTP", "ENTJ", "ENTP"]
  description: string;
  traits: string[];
  color: string;     // å¦‚ "#88619A"
}
```
</details>

<details>
<summary><b>MBTITestResult</b>: æµ‹è¯•ç»“æœ</summary>

```typescript
interface MBTITestResult {
  type: string;  // å¦‚ "INTJ-A"
  scores: {
    EI_E: number, EI_I: number,
    SN_S: number, SN_N: number,
    TF_T: number, TF_F: number,
    JP_J: number, JP_P: number,
    AT_A: number, AT_T: number
  };
}
```
</details>

---

## ğŸ§© MBTIæµ‹è¯•å®ç°ç»†èŠ‚

### 1. æµ‹è¯•æµç¨‹

```mermaid
graph LR
    A[è·å–é—®é¢˜] --> B[æäº¤ç­”æ¡ˆ]
    B --> C[è®¡ç®—ç»“æœ]
    C --> D[ä¿å­˜ç»“æœ]
    D --> E[æŸ¥çœ‹å†å²]
```

1. ç”¨æˆ·è·å–æµ‹è¯•é—®é¢˜ (`GET /api/mbti/questions`)
2. ç”¨æˆ·æäº¤æµ‹è¯•ç­”æ¡ˆ (`POST /api/mbti/test`)
3. ç³»ç»Ÿè®¡ç®—æµ‹è¯•ç»“æœå¹¶ä¿å­˜
4. ç”¨æˆ·å¯æŸ¥çœ‹æµ‹è¯•å†å² (`GET /api/mbti/user/:userId/history`)

### 2. ç»“æœè®¡ç®—é€»è¾‘

<details>
<summary>å±•å¼€æŸ¥çœ‹ç»“æœè®¡ç®—ä»£ç </summary>

```typescript
private calculateTestResult(responses: MBTITestResponse[]): MBTITestResult {
  // åˆå§‹åŒ–åˆ†æ•°
  const scores = {
    EI_E: 0, EI_I: 0,
    SN_S: 0, SN_N: 0,
    TF_T: 0, TF_F: 0,
    JP_J: 0, JP_P: 0,
    AT_A: 0, AT_T: 0
  };
  
  // ç´¯è®¡æ¯ä¸ªç»´åº¦çš„åˆ†æ•°
  for (const response of responses) {
    switch (response.selected_value) {
      case 'E': scores.EI_E++; break;
      case 'I': scores.EI_I++; break;
      // ...å…¶ä»–ç»´åº¦
    }
  }
  
  // ç¡®å®šæ¯ä¸ªç»´åº¦çš„ä¸»å¯¼ç‰¹è´¨
  const E_I = scores.EI_E > scores.EI_I ? 'E' : 'I';
  const S_N = scores.SN_S > scores.SN_N ? 'S' : 'N';
  const T_F = scores.TF_T > scores.TF_F ? 'T' : 'F';
  const J_P = scores.JP_J > scores.JP_P ? 'J' : 'P';
  const A_T = scores.AT_A > scores.AT_T ? 'A' : 'T';
  
  // ç»„åˆMBTIç±»å‹
  const mbtiType = `${E_I}${S_N}${T_F}${J_P}-${A_T}`;
  
  return {
    type: mbtiType,
    scores
  };
}
```
</details>

### 3. æ•°æ®åº“é›†åˆ

MBTIæµ‹è¯•ç³»ç»Ÿä½¿ç”¨äº†ä»¥ä¸‹MongoDBé›†åˆï¼š

| é›†åˆåç§° | ç”¨é€” |
|---------|------|
| `mbti_questions` | å­˜å‚¨æµ‹è¯•é—®é¢˜ |
| `mbti_types` | å­˜å‚¨MBTIç±»å‹æè¿° |
| `mbti_roles` | å­˜å‚¨MBTIè§’è‰²åˆ†ç±» |
| `mbti_test_results` | å­˜å‚¨ç”¨æˆ·æµ‹è¯•è®°å½• |

---

## ğŸ—„ï¸ MongoDBæ•°æ®åº“æ“ä½œ

é¡¹ç›®ä½¿ç”¨è‡ªå®šä¹‰çš„`MongoDBService`ç±»è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š

### è¿æ¥æ•°æ®åº“

```typescript
// åˆå§‹åŒ–è¿æ¥
const mongoDBService = new MongoDBService({
  uri: "mongodb://[username]:[password]@[host]/",
  dbName: "database_name"
});

// è¿æ¥æ•°æ®åº“
await mongoDBService.connect();

// å…³é—­è¿æ¥
await mongoDBService.close();
```

### åŸºæœ¬CRUDæ“ä½œ

<details>
<summary>å±•å¼€æŸ¥çœ‹CRUDæ“ä½œç¤ºä¾‹</summary>

```typescript
// æŸ¥è¯¢æ–‡æ¡£
const documents = await mongoDBService.find("collection_name", { field: "value" });

// æ ¹æ®IDæŸ¥è¯¢
const document = await mongoDBService.findById("collection_name", "id");

// æ’å…¥æ–‡æ¡£
const result = await mongoDBService.insertOne("collection_name", { field: "value" });

// æ‰¹é‡æ’å…¥
const result = await mongoDBService.insertMany("collection_name", [{ field: "value" }]);

// æ›´æ–°æ–‡æ¡£
const result = await mongoDBService.updateOne(
  "collection_name", 
  { field: "value" }, 
  { $set: { field: "new_value" } }
);

// æ ¹æ®IDæ›´æ–°
const result = await mongoDBService.updateById("collection_name", "id", { field: "value" });

// åˆ é™¤æ–‡æ¡£
const result = await mongoDBService.deleteOne("collection_name", { field: "value" });

// æ ¹æ®IDåˆ é™¤
const result = await mongoDBService.deleteById("collection_name", "id");

// èšåˆæŸ¥è¯¢
const result = await mongoDBService.aggregate("collection_name", [
  { $match: { field: "value" } },
  { $group: { _id: "$field", count: { $sum: 1 } } }
]);
```
</details>

### MBTIå®é™…æ•°æ®åº“æ“ä½œç¤ºä¾‹

<details>
<summary>æŸ¥è¯¢æ‰€æœ‰MBTIç±»å‹</summary>

```typescript
async getAllTypes(): Promise<MBTIType[]> {
  try {
    await this.mongoDBService.connect();
    const types = await this.mongoDBService.find(this.typesCollection, {});
    return types as unknown as MBTIType[];
  } catch (error) {
    this.logger.error("è·å–æ‰€æœ‰MBTIç±»å‹å¤±è´¥:", error);
    throw error;
  } finally {
    await this.mongoDBService.close();
  }
}
```

</details>

<details>
<summary>ä¿å­˜æµ‹è¯•ç»“æœ</summary>

```typescript
// æ–°ç”¨æˆ·ï¼Œåˆ›å»ºè®°å½•
const newUserData = {
  user_id: testData.user_id,
  nickname: testData.nickname || testData.user_id,
  tests: [{
    test_id: testId,
    test_date: now,
    completed: isCompleted,
    responses: testData.responses,
    result: testResult
  }],
  test_count: 1,
  latest_type: testResult?.type || null,
  created_at: now,
  updated_at: now
};

await this.mongoDBService.insertOne(this.testResultsCollection, newUserData);
```
</details>

<details>
<summary>æ›´æ–°ç°æœ‰è®°å½•</summary>

```typescript
// ç°æœ‰ç”¨æˆ·ï¼Œæ›´æ–°è®°å½•
const userData = existingUsers[0] as Record<string, unknown>;
const tests = userData.tests as Array<Record<string, unknown>> || [];

tests.push({
  test_id: testId,
  test_date: now,
  completed: isCompleted,
  responses: testData.responses,
  result: testResult
});

const updateData: Record<string, unknown> = {
  tests,
  test_count: tests.length,
  updated_at: now
};

// å¦‚æœæµ‹è¯•å®Œæˆï¼Œæ›´æ–°æœ€æ–°ç±»å‹
if (isCompleted && testResult) {
  updateData.latest_type = testResult.type;
}

await this.mongoDBService.updateOne(
  this.testResultsCollection,
  { user_id: testData.user_id },
  { $set: updateData }
);
```
</details>

### åˆ†é¡µæŸ¥è¯¢

```typescript
const result = await mongoDBService.paginate(
  "collection_name",   // é›†åˆåç§°
  1,                   // é¡µç 
  10,                  // æ¯é¡µè®°å½•æ•°
  { field: "value" },  // æŸ¥è¯¢æ¡ä»¶
  { sort: { field: 1 } } // æ’åºé€‰é¡¹
);
```

#### è¿”å›ç»“æœæ ¼å¼

| å­—æ®µ | æè¿° |
|------|------|
| `data` | æ•°æ®æ•°ç»„ |
| `total` | æ€»è®°å½•æ•° |
| `page` | å½“å‰é¡µç  |
| `limit` | æ¯é¡µè®°å½•æ•° |
| `pageCount` | æ€»é¡µæ•° |

---

## ğŸ§° MongoDBæŸ¥è¯¢è¯­æ³•

### å¸¸ç”¨æ“ä½œç¬¦

<details>
<summary>å±•å¼€æŸ¥çœ‹å¸¸ç”¨æŸ¥è¯¢æ“ä½œç¬¦</summary>

```typescript
// ç›¸ç­‰æŸ¥è¯¢
{ field: "value" }

// ä¸ç­‰æŸ¥è¯¢
{ field: { $ne: "value" } }

// å¤§äº/å°äº
{ field: { $gt: 10 } }  // å¤§äº
{ field: { $lt: 10 } }  // å°äº
{ field: { $gte: 10 } } // å¤§äºç­‰äº
{ field: { $lte: 10 } } // å°äºç­‰äº

// INæŸ¥è¯¢
{ field: { $in: ["value1", "value2"] } }

// é€»è¾‘æ“ä½œç¬¦
{ $and: [{ field1: "value1" }, { field2: "value2" }] }
{ $or: [{ field1: "value1" }, { field1: "value2" }] }

// æ­£åˆ™è¡¨è¾¾å¼
{ field: { $regex: "pattern", $options: "i" } } // iè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™

// å­˜åœ¨æ€§æ£€æŸ¥
{ field: { $exists: true } }
```
</details>

### æ›´æ–°æ“ä½œç¬¦

<details>
<summary>å±•å¼€æŸ¥çœ‹å¸¸ç”¨æ›´æ–°æ“ä½œç¬¦</summary>

```typescript
// è®¾ç½®å­—æ®µå€¼
{ $set: { field: "new_value" } }

// å¢åŠ æ•°å€¼
{ $inc: { counter: 1 } }

// æ·»åŠ åˆ°æ•°ç»„
{ $push: { array_field: "new_item" } }

// ä»æ•°ç»„ç§»é™¤
{ $pull: { array_field: "item_to_remove" } }

// æ·»åŠ åˆ°é›†åˆï¼ˆä¸é‡å¤ï¼‰
{ $addToSet: { array_field: "new_unique_item" } }
```
</details>

---

## ğŸ“ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ

### æ•°æ®åº“è¿æ¥ç®¡ç†

- âœ… å§‹ç»ˆåœ¨æ“ä½œç»“æŸåå…³é—­æ•°æ®åº“è¿æ¥ï¼ˆä½¿ç”¨`finally`å—ï¼‰
- âœ… ä½¿ç”¨try-catch-finallyå¤„ç†æ•°æ®åº“æ“ä½œå¯èƒ½å‡ºç°çš„å¼‚å¸¸

### é”™è¯¯å¤„ç†å’Œæ—¥å¿—

- âœ… ä½¿ç”¨ç»Ÿä¸€çš„Loggerç±»è¿›è¡Œæ—¥å¿—è®°å½•
- âœ… æ‰€æœ‰å¤–éƒ¨è°ƒç”¨ï¼ˆæ•°æ®åº“ã€APIï¼‰éƒ½åº”æœ‰é”™è¯¯å¤„ç†

### MongoDBæ“ä½œ

- âœ… ä½¿ç”¨`countDocuments`è€Œä¸æ˜¯å·²åºŸå¼ƒçš„`count`æ–¹æ³•
- âœ… ä½¿ç”¨`find`æ–¹æ³•æ—¶æ·»åŠ åˆé€‚çš„æŠ•å½±(projection)ä»¥å‡å°‘æ•°æ®ä¼ è¾“
- âœ… å¯¹å¤§ç»“æœé›†ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢

### å®‰å…¨æ€§

- ğŸ”’ æ•æ„ŸAPIä½¿ç”¨`authMiddleware`è¿›è¡Œä¿æŠ¤
- ğŸ”’ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰

### æ€§èƒ½ä¼˜åŒ–

- âš¡ å¤§é‡æ–‡æ¡£ä½¿ç”¨æ‰¹é‡æ“ä½œï¼ˆinsertMany, updateManyï¼‰
- âš¡ æ·»åŠ é€‚å½“çš„ç´¢å¼•ä»¥åŠ é€ŸæŸ¥è¯¢
- âš¡ ä½¿ç”¨æŠ•å½±é™åˆ¶è¿”å›å­—æ®µ

### ç‰¹å®šé¡¹ç›®æ³¨æ„äº‹é¡¹

- ğŸ“‹ MBTIæµ‹è¯•éœ€è¦è‡³å°‘16ä¸ªé—®é¢˜æ‰èƒ½å®Œæˆ
- ğŸ“‹ æ¯ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªæµ‹è¯•è®°å½•
- ğŸ“‹ APIå“åº”æ ¼å¼ä¿æŒä¸€è‡´ï¼ˆåŒ…å«success, code, data/messageå­—æ®µï¼‰

---

### APIå“åº”æ ¼å¼è®¾è®¡

ä¸ºç¡®ä¿å‰ç«¯èƒ½é«˜æ•ˆå¤„ç†APIå“åº”ï¼Œæ‰€æœ‰APIåº”éµå¾ªä¸€è‡´çš„å“åº”æ ¼å¼ï¼š

```typescript
interface ApiResponse<T> {
  success: boolean;     // è¯·æ±‚æ˜¯å¦æˆåŠŸ
  code: number;         // çŠ¶æ€ç ï¼Œä¸HTTPçŠ¶æ€ç ä¿æŒä¸€è‡´
  data?: T;             // æˆåŠŸæ—¶è¿”å›çš„æ•°æ®
  message?: string;     // é”™è¯¯æ—¶çš„æ¶ˆæ¯
  pagination?: {        // åˆ†é¡µä¿¡æ¯ï¼ˆå¦‚é€‚ç”¨ï¼‰
    total: number;
    page: number;
    limit: number;
    pageCount: number;
  };
}
```

### å‰ç«¯å®ç°å»ºè®®

1. **MBTIæµ‹è¯•ç•Œé¢è®¾è®¡**:
   - é‡‡ç”¨åˆ†æ­¥éª¤å±•ç¤ºé—®é¢˜ï¼Œå‡è½»ç”¨æˆ·è´Ÿæ‹…
   - è¿›åº¦æŒ‡ç¤ºå™¨æ˜¾ç¤ºå®Œæˆæƒ…å†µ
   - ä½¿ç”¨ç›´è§‚çš„é€‰é¡¹è®¾è®¡ï¼ˆå¦‚æ»‘å—ã€å•é€‰æŒ‰é’®ï¼‰
   - ç»“æœé¡µé¢çªå‡ºæ˜¾ç¤ºç”¨æˆ·çš„MBTIç±»å‹å’Œç‰¹ç‚¹

2. **å“åº”å¼è®¾è®¡**:
   - ç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡å’Œæ¡Œé¢è®¾å¤‡ä¸Šéƒ½æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ
   - é’ˆå¯¹ä¸åŒå±å¹•å°ºå¯¸ä¼˜åŒ–å¸ƒå±€
   - è€ƒè™‘è§¦æ‘¸æ“ä½œçš„ä¾¿åˆ©æ€§

3. **æ€§èƒ½ä¼˜åŒ–**:
   - å®æ–½æ‡’åŠ è½½æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯å¯¹MBTIç±»å‹è¯¦æƒ…é¡µé¢
   - ç¼“å­˜ç”¨æˆ·å†å²æµ‹è¯•ç»“æœ
   - ä¼˜åŒ–å›¾ç‰‡å’Œèµ„æºåŠ è½½

4. **äº¤äº’ä½“éªŒä¼˜åŒ–**:
   - æ·»åŠ é€‚å½“çš„åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
   - å®ç°å³æ—¶åé¦ˆæœºåˆ¶
   - è€ƒè™‘ç¦»çº¿æ”¯æŒï¼Œå…è®¸ç”¨æˆ·åœ¨æ— ç½‘ç»œæƒ…å†µä¸‹å®Œæˆæµ‹è¯•

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

- ğŸ“± **å¼•å¯¼å¼æµ‹è¯•æµç¨‹**: æä¾›æ¸…æ™°çš„æŒ‡å¼•å’Œè¯´æ˜
- ğŸ¯ **ä¸ªæ€§åŒ–ç»“æœå±•ç¤º**: æ ¹æ®ç”¨æˆ·çš„MBTIç±»å‹æä¾›ä¸ªæ€§åŒ–çš„ç»“æœé¡µé¢
- ğŸ”„ **ç¤¾äº¤åˆ†äº«åŠŸèƒ½**: å…è®¸ç”¨æˆ·åˆ†äº«ä»–ä»¬çš„æµ‹è¯•ç»“æœåˆ°ç¤¾äº¤åª’ä½“
- ğŸŒ“ **ä¸»é¢˜å®šåˆ¶**: æä¾›æµ…è‰²/æ·±è‰²æ¨¡å¼åˆ‡æ¢

---

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

### MongoDBè¿æ¥é—®é¢˜

- ğŸ” æ£€æŸ¥URIå’Œæ•°æ®åº“åç§°é…ç½®
- ğŸ” ç¡®è®¤MongoDBæœåŠ¡å™¨è¿è¡ŒçŠ¶æ€
- ğŸ” æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### APIè¿”å›ç©ºæ•°æ®

- ğŸ” æ£€æŸ¥æ•°æ®åº“è¿æ¥
- ğŸ” ç¡®è®¤é›†åˆä¸­æœ‰æ•°æ®
- ğŸ” éªŒè¯æŸ¥è¯¢æ¡ä»¶æ˜¯å¦æ­£ç¡®

### æƒé™é—®é¢˜

- ğŸ” ç¡®è®¤ç”¨æˆ·æœ‰æ­£ç¡®çš„æ•°æ®åº“æƒé™
- ğŸ” éªŒè¯æˆæƒä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ

### éƒ¨ç½²ç›¸å…³é—®é¢˜

- ğŸ” ç¡®ä¿ç›®æ ‡ç¯å¢ƒåŒ…å«æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡
- ğŸ” æ£€æŸ¥è¿è¡Œå‘½ä»¤æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…è¦çš„æƒé™æ ‡å¿—

---

## ğŸš€ æ‰©å±•å’Œæ”¹è¿›

1. **APIæ–‡æ¡£**: è€ƒè™‘æ·»åŠ Swaggeræˆ–ç±»ä¼¼å·¥å…·
2. **ç¼“å­˜å±‚**: ä¸ºé¢‘ç¹è®¿é—®çš„æ•°æ®æ·»åŠ ç¼“å­˜
3. **ç›‘æ§**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œå¥åº·æ£€æŸ¥
4. **CI/CD**: è®¾ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

---

å»ºè®®åœ¨`deno.json`ä¸­é›†ä¸­ç®¡ç†æ‰€æœ‰ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä¾¿äºåç»­å‡çº§å’Œç»´æŠ¤ï¼š

```json
{
  "imports": {
    "oak": "jsr:@oak/oak@^12.6.1",
    "mongoose": "npm:mongoose@^8.0.0",
    "std/": "https://deno.land/std@0.196.0/"
  }
}
```

---

## ğŸš¢ Denoéƒ¨ç½²æŒ‡å—

### ä½¿ç”¨Deno Deploy

[Deno Deploy](https://deno.com/deploy)æ˜¯å®˜æ–¹çš„serverlesså¹³å°ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²Denoåº”ç”¨ã€‚

#### 1. ä½¿ç”¨deployctlå·¥å…·

é¦–å…ˆå®‰è£…deployctlå·¥å…·ï¼š

```bash
deno install --allow-read --allow-write --allow-env --allow-net --allow-run --no-check -r -f https://deno.land/x/deploy/deployctl.ts
```

#### 2. éƒ¨ç½²é¡¹ç›®

```bash
# ç›´æ¥éƒ¨ç½²
deployctl deploy --project=your-project-name main.ts

# æŒ‡å®šç¯å¢ƒå˜é‡
deployctl deploy --project=your-project-name --env-file=.env main.ts
```

#### 3. é€šè¿‡deno.jsoné…ç½®

é¡¹ç›®çš„`deno.json`å¯ä»¥åŒ…å«éƒ¨ç½²é…ç½®ï¼š

```json
{
  "deploy": {
    "project": "your-project-id",
    "exclude": ["**/node_modules"],
    "include": [],
    "entrypoint": "main.ts"
  }
}
```

ç„¶åæ‰§è¡Œï¼š

```bash
deno task deploy
```

### éƒ¨ç½²å‰çš„å‡†å¤‡

1. **ç¡®ä¿é¡¹ç›®ç»“æ„æ­£ç¡®**ï¼š
   - å…¥å£æ–‡ä»¶åº”è¯¥æ˜¯è‡ªåŒ…å«çš„ï¼Œæˆ–è€…èƒ½å¤Ÿè®¿é—®æ‰€æœ‰ä¾èµ–
   - ç¡®ä¿æ‰€æœ‰è·¯å¾„æ­£ç¡®ï¼ˆç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼‰

2. **ç¯å¢ƒå˜é‡å¤„ç†**ï¼š
   - éƒ¨ç½²ç¯å¢ƒéœ€è¦è®¾ç½®æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡
   - å¯ä»¥åœ¨Deno Deployæ§åˆ¶å°ä¸­é…ç½®ç¯å¢ƒå˜é‡
   - æ•æ„Ÿä¿¡æ¯ä¸åº”ç¡¬ç¼–ç æˆ–åŒ…å«åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­

3. **æ–‡ä»¶ç³»ç»Ÿé™åˆ¶**ï¼š
   - Deno Deployä¸æ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå†™å…¥
   - æ‰€æœ‰æ–‡ä»¶æ“ä½œåº”æ›¿æ¢ä¸ºå­˜å‚¨æœåŠ¡(å¦‚MongoDB)æˆ–å†…å­˜å­˜å‚¨

4. **ç½‘ç»œè®¿é—®å’Œç¬¬ä¸‰æ–¹æœåŠ¡**ï¼š
   - ç¡®ä¿æ‰€æœ‰å¤–éƒ¨æœåŠ¡éƒ½èƒ½ä»Deno Deployè®¿é—®
   - ä½¿ç”¨é€‚å½“çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥å¤„ç†é—´æ­‡æ€§è¿æ¥é—®é¢˜

### æ³¨æ„äº‹é¡¹å’Œé™åˆ¶

1. **å†·å¯åŠ¨**:
   - Serverlessç¯å¢ƒå¯èƒ½æœ‰å†·å¯åŠ¨å»¶è¿Ÿ
   - å…³é”®æœåŠ¡åº”ä¼˜åŒ–ä»¥å¿«é€Ÿåˆå§‹åŒ–

2. **æ‰§è¡Œæ—¶é—´é™åˆ¶**:
   - è¯·æ±‚å¤„ç†æ—¶é—´æœ‰é™åˆ¶ï¼Œé•¿æ—¶é—´æ“ä½œåº”æ‹†åˆ†æˆ–å¼‚æ­¥å¤„ç†

3. **å†…å­˜é™åˆ¶**:
   - éµå¾ªå†…å­˜æœ€ä½³å®è·µï¼Œé¿å…å†…å­˜æ³„æ¼
   - å¤§å‹å¯¹è±¡åº”åˆ†å—å¤„ç†æˆ–ä½¿ç”¨æµå¤„ç†

4. **ä¾èµ–é¡¹**:
   - ç¡®ä¿æ‰€æœ‰ä¾èµ–é¡¹éƒ½ä¸Deno Deployå…¼å®¹
   - æŸäº›ä¾èµ–äºNode.js APIçš„npmåŒ…å¯èƒ½ä¸å…¼å®¹
   - ä½¿ç”¨Denoæ ‡å‡†åº“æˆ–ä¸“é—¨çš„DenoåŒ…ä»¥è·å¾—æœ€ä½³ä½“éªŒ

5. **æ•°æ®åº“è¿æ¥**:
   - ä½¿ç”¨è¿æ¥æ± å’Œåˆé€‚çš„è¿æ¥ç®¡ç†ç­–ç•¥
   - é˜²æ­¢è¿æ¥æ³„æ¼ï¼Œç¡®ä¿åœ¨è¯·æ±‚ç»“æŸæ—¶å…³é—­è¿æ¥

6. **å®šæ—¶ä»»åŠ¡**:
   - Deno Deployæ”¯æŒé€šè¿‡Cronè§¦å‘å™¨è¿è¡Œå®šæ—¶ä»»åŠ¡
   - å¯¹äºå¤æ‚çš„è°ƒåº¦éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦å¤–éƒ¨æœåŠ¡

### éƒ¨ç½²åçš„ç›‘æ§

- ä½¿ç”¨Deno Deployæä¾›çš„æ—¥å¿—å’ŒæŒ‡æ ‡ç›‘æ§åº”ç”¨æ€§èƒ½
- è€ƒè™‘æ·»åŠ è‡ªå®šä¹‰æ—¥å¿—è®°å½•ä»¥è·Ÿè¸ªå…³é”®æ“ä½œ
- å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹ä»¥ç›‘æ§æœåŠ¡çŠ¶æ€

```typescript
// å¥åº·æ£€æŸ¥ç«¯ç‚¹ç¤ºä¾‹
router.get("/health", (ctx) => {
  ctx.response.status = 200;
  ctx.response.body = {
    status: "ok",
    timestamp: new Date().toISOString(),
    version: "1.0.0"
  };
});
```

---

## ğŸ“ ä»£ç è§„èŒƒ

- ğŸ“„ ä½¿ç”¨TSDocé£æ ¼çš„æ³¨é‡Š
- ğŸ”„ ä¿æŒä¸€è‡´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•æ¨¡å¼
- ğŸ§© éµå¾ªæ¨¡å—åŒ–è®¾è®¡åŸåˆ™

---

## ğŸ“š èµ„æºé“¾æ¥

- [Denoå®˜æ–¹æ–‡æ¡£](https://deno.land/manual)
- [Oak HTTPæœåŠ¡å™¨æ¡†æ¶æ–‡æ¡£](https://deno.land/x/oak)
- [MongoDBæ–‡æ¡£](https://www.mongodb.com/docs/)
- [Mongooseæ–‡æ¡£](https://mongoosejs.com/docs/)
- [MBTIå®˜æ–¹ç½‘ç«™](https://www.myersbriggs.org/)
- [16Personalities](https://www.16personalities.com/)
